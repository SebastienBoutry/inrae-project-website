---
params:
  hal_project_name: "DYLAQ"
  hal_collection: "EABX"
nocite: |
  @*
bibliography: API_HAL_project.bib
margin-header: |
  ![](image/Logo_project.jpg)
margin-footer: |
  ![](image/VALISE_LOGOTYPE/SIGLE/RVB_web/Sigle - INRAE.jpg)
---

::: {.content-visible when-profile="english"}
This web page uses the [HAL API](https://api.archives-ouvertes.fr/docs) to retrieve the project's bibliographic references. To do this, you need to fill in the following two parameters (hal_project_name and hal_collection) in the YAML.
For this request to be successful, it is important to fill in the 'Collaboration/Project' field when submitting to HAL with the project acronym, which will be identical to hal_project_name. The choice of limiting references linked to the project to a target collection.
The creation of an API_HAL_project.bib file fills in all the references linked to the hal_project_name, limited by the hal_collection field.
:::

::: {.content-visible when-profile="francais"}
Voir la version anglaise pour quelques explications
:::

```{r echo=FALSE, eval=TRUE, warning=FALSE, message=FALSE, error=FALSE, include=FALSE, results="asis"}
library(httr2)
library(readr)
library(bibtex)
library(bib2df)

## API call to HAL
request_project <- paste0("https://api.archives-ouvertes.fr/search/?q=*","&fq=collaboration_s:",params$hal_project_name,
                          "&fq=collCode_s:",params$hal_collection,
                          "&rows=10000&wt=bibtex")
req<-request(request_project) |>
  req_perform() 

if(length(req$body)>0){
  remove(list = "API_HAL_project.bib")
  req |> 
    resp_body_string() |>
    unlist() |>
    write_lines("API_HAL_project.bib")
}else{
}
```



## List of publications (based on HAL-INRAE)

::: {#refs}
:::

---

## WordCloud of keywords's publications

```{r keywords, echo=FALSE, eval=TRUE, warning=FALSE, message=FALSE, results="asis"}
if(sum(dir() %in% "API_HAL_project.bib")>0){
df_refs <-bib2df::bib2df("API_HAL_project.bib") |> 
  tibble::as_tibble()

if(nrow(df_refs)>0){
  tibble::tibble(keywords=df_refs |> 
                   dplyr::filter(! is.na(KEYWORDS)) |> 
                   dplyr::pull(KEYWORDS) |> 
                   stringr::str_to_upper() |> 
                   paste0(collapse = " ; ") |> 
                   stringr::str_split(";") |> 
                   unlist() |> 
                   stringr::str_trim()) |> 
    dplyr::count(keywords) |> 
    wordcloud2::wordcloud2(backgroundColor="#275662",
                           size=0.2,
                           color="white",
                           minRotation = -pi/6,
                           maxRotation = -pi/6)
}else{
  print("no publications based on HAL-INRAE")
}
}else{ print("no publications based on HAL-INRAE")}
```



